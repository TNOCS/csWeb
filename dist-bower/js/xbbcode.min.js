"use strict";var XBBCODE=function(){function e(t,n,r,o,a,i,u){u=u||[],r++;var p,g,f,b,d=new RegExp("(<bbcl="+r+" )("+l.join("|")+")([ =>])","gi"),T=new RegExp("(<bbcl="+r+" )("+l.join("|")+")([ =>])","i"),h=i.match(d)||[],x=c[t]||{};for(d.lastIndex=0,h||(i=""),f=0;f<h.length;f++)T.lastIndex=0,b=h[f].match(T)[2].toLowerCase(),x.restrictChildrenTo.length>0&&(x.validChildLookup[b]||(g='The tag "'+b+'" is not allowed as a child of the tag "'+t+'".',u.push(g))),p=c[b]||{},p.restrictParentsTo.length>0&&(p.validParentLookup[t]||(g='The tag "'+t+'" is not allowed as a parent of the tag "'+b+'".',u.push(g)));return i=i.replace(s,function(t,n,r,o,a){return u=e(r,t,n,r,o,a,u),t}),u}function t(e){return e=e.replace(/\<([^\>][^\>]*?)\>/gi,function(e,t){var n=t.match(/^bbcl=([0-9]+) /);return null===n?"<bbcl=0 "+t+">":"<"+t.replace(/^(bbcl=)([0-9]+)/,function(e,t,n){return t+(parseInt(n,10)+1)})+">"})}function n(e){return e.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;")}function r(e){var t=e.text;return t=t.replace(s,x)}function o(e){for(e=e.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/gi,"<"),e=e.replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/gi,">");e!==(e=e.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(e){for(var t=e;t!==(t=t.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(e,t,n){n=">/list]"===n?"</*]</list]":"</*][*]";var r="<*]"+t+n;return r})););return t=t.replace(/>/g,"<")})););return e=e.replace(/</g,"[")}function a(e){for(;e!==(e=e.replace(i,function(e){return e=e.replace(/\[/g,"<"),e=e.replace(/\]/g,">"),t(e)})););return e}var c,l,s,i,u,p,g,f={},b=/^(?:https?|file|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:@#%&()~_?\+=\/\\\.]*$/,d=/^(?:red|green|blue|orange|yellow|black|white|brown|gray|silver|purple|maroon|fushsia|lime|olive|navy|teal|aqua)$/,T=/^#?[a-fA-F0-9]{6}$/,h=[];c={b:{openTag:function(){return'<span class="xbbcode-b">'},closeTag:function(){return"</span>"}},bbcode:{openTag:function(){return""},closeTag:function(){return""}},code:{openTag:function(){return'<span class="xbbcode-code">'},closeTag:function(){return"</span>"},noParse:!0},color:{openTag:function(e){var t=e.substr(1)||"black";return d.lastIndex=0,T.lastIndex=0,d.test(t)||(T.test(t)?"#"!==t.substr(0,1)&&(t="#"+t):t="black"),'<span style="color:'+t+'">'},closeTag:function(){return"</span>"}},i:{openTag:function(){return'<span class="xbbcode-i">'},closeTag:function(){return"</span>"}},img:{openTag:function(e,t){var n=t;return b.lastIndex=0,b.test(n)||(n=""),'<img src="'+n+'" />'},closeTag:function(){return""},displayContent:!1},list:{openTag:function(){return"<ul>"},closeTag:function(){return"</ul>"},restrictChildrenTo:["*","li"]},noparse:{openTag:function(){return""},closeTag:function(){return""},noParse:!0},php:{openTag:function(){return'<span class="xbbcode-code">'},closeTag:function(){return"</span>"},noParse:!0},quote:{openTag:function(){return'<blockquote class="xbbcode-blockquote">'},closeTag:function(){return"</blockquote>"}},s:{openTag:function(){return'<span class="xbbcode-s">'},closeTag:function(){return"</span>"}},size:{openTag:function(e){var t=parseInt(e.substr(1),10)||0;return(4>t||t>40)&&(t=14),'<span class="xbbcode-size-'+t+'">'},closeTag:function(){return"</span>"}},table:{openTag:function(){return'<table class="xbbcode-table">'},closeTag:function(){return"</table>"},restrictChildrenTo:["tbody","thead","tfoot","tr"]},tbody:{openTag:function(){return"<tbody>"},closeTag:function(){return"</tbody>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},tfoot:{openTag:function(){return"<tfoot>"},closeTag:function(){return"</tfoot>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},thead:{openTag:function(){return'<thead class="xbbcode-thead">'},closeTag:function(){return"</thead>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},td:{openTag:function(){return'<td class="xbbcode-td">'},closeTag:function(){return"</td>"},restrictParentsTo:["tr"]},th:{openTag:function(){return'<td class="xbbcode-th">'},closeTag:function(){return"</td>"},restrictParentsTo:["tr"]},tr:{openTag:function(){return'<tr class="xbbcode-tr">'},closeTag:function(){return"</tr>"},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},u:{openTag:function(){return'<span class="xbbcode-u">'},closeTag:function(){return"</span>"}},url:{openTag:function(e,t){var n;return n=e?e.substr(1):t.replace(/<.*?>/g,""),b.lastIndex=0,b.test(n)||(n="#"),'<a href="'+n+'" target="_blank">'},closeTag:function(){return"</a>"}},"*":{openTag:function(){return"<li>"},closeTag:function(){return"</li>"},restrictParentsTo:["list"]}},l=[],function(){var e,t,n;for(e in c)if(c.hasOwnProperty(e)){for("*"===e?l.push("\\"+e):(l.push(e),c[e].noParse&&h.push(e)),c[e].validChildLookup={},c[e].validParentLookup={},c[e].restrictParentsTo=c[e].restrictParentsTo||[],c[e].restrictChildrenTo=c[e].restrictChildrenTo||[],n=c[e].restrictChildrenTo.length,t=0;n>t;t++)c[e].validChildLookup[c[e].restrictChildrenTo[t]]=!0;for(n=c[e].restrictParentsTo.length,t=0;n>t;t++)c[e].validParentLookup[c[e].restrictParentsTo[t]]=!0}}(),s=new RegExp("<bbcl=([0-9]+) ("+l.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi"),i=new RegExp("\\[("+l.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi"),u=new RegExp("\\[("+h.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi"),function(){for(var e=[],t=0;t<l.length;t++)"\\*"!==l[t]&&e.push("/"+l[t]);p=new RegExp("(\\[)((?:"+l.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi"),g=new RegExp("(\\[)("+e.join("|")+")(\\])","gi")}();var x=function(e,t,r,o,a){r=r.toLowerCase();var l=c[r].noParse?n(a):a.replace(s,x),i=c[r].openTag(o,l),u=c[r].closeTag(o,l);return c[r].displayContent===!1&&(l=""),i+l+u};return f.process=function(t){var n={html:"",error:!1},c=[];for(t.text=t.text.replace(/</g,"&lt;"),t.text=t.text.replace(/>/g,"&gt;"),t.text=t.text.replace(p,function(e,t,n){return"<"+n+">"}),t.text=t.text.replace(g,function(e,t,n){return"<"+n+">"}),t.text=t.text.replace(/\[/g,"&#91;"),t.text=t.text.replace(/\]/g,"&#93;"),t.text=t.text.replace(/</g,"["),t.text=t.text.replace(/>/g,"]");t.text!==(t.text=t.text.replace(u,function(e,t,n,r){return r=r.replace(/\[/g,"&#91;"),r=r.replace(/\]/g,"&#93;"),n=n||"",r=r||"","["+t+n+"]"+r+"[/"+t+"]"})););return t.text=o(t.text),t.text=a(t.text),c=e("bbcode",t.text,-1,"","",t.text),n.html=r(t),(-1!==n.html.indexOf("[")||-1!==n.html.indexOf("]"))&&c.push("Some tags appear to be misaligned."),t.removeMisalignedTags&&(n.html=n.html.replace(/\[.*?\]/g,"")),t.addInLineBreaks&&(n.html=n.html.replace(/\r\n/g,"\n"),n.html=n.html.replace(/(\r|\n)/g,"$1<br/>")),n.html=n.html.replace("&#91;","["),n.html=n.html.replace("&#93;","]"),n.error=0===c.length?!1:!0,n.errorQueue=c,n},f}();